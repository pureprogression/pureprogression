# –§–∏–Ω–∞–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç - —á—Ç–æ –æ—Å—Ç–∞–ª–æ—Å—å —Å–¥–µ–ª–∞—Ç—å

## ‚úÖ –£–ñ–ï –°–î–ï–õ–ê–ù–û:
1. ‚úÖ –ö–æ–¥ –¥–æ–±–∞–≤–ª–µ–Ω –≤ functions.php WordPress
2. ‚úÖ –í—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏ API —Å–æ–∑–¥–∞–Ω—ã
3. ‚úÖ –ó–∞—â–∏—Ç–∞ —Å—Ç—Ä–∞–Ω–∏—Ü –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∞

## üìã –ß–¢–û –û–°–¢–ê–õ–û–°–¨ (2 –ø—Ä–æ—Å—Ç—ã—Ö —à–∞–≥–∞):

### –®–ê–ì 1: –î–æ–±–∞–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –≤ .env.local (1 –º–∏–Ω—É—Ç–∞)

–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ —Ñ–∞–π–ª `.env.local` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ Next.js –∏ –¥–æ–±–∞–≤—å—Ç–µ:

```env
WEBHOOK_SECRET=1fddaef9da810cd310872383c3d27a05a2c97618ea94f358f3178e1ad23702c5
```

**–ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è:** –í –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞ `purep-web`, —Ä—è–¥–æ–º —Å `package.json`

**–í–∞–∂–Ω–æ:** –ï—Å–ª–∏ —Ñ–∞–π–ª–∞ `.env.local` –Ω–µ—Ç, —Å–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ!

### –®–ê–ì 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å —Ü–µ–Ω—ã –ø–æ–¥–ø–∏—Å–∫–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

–ï—Å–ª–∏ —Ö–æ—Ç–∏—Ç–µ –∏–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—ã, –æ—Ç–∫—Ä–æ–π—Ç–µ `src/app/subscribe/page.js` –∏ –Ω–∞–π–¥–∏—Ç–µ:

```javascript
const SUBSCRIPTION_PLANS = {
  monthly: {
    price: 990, // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é —Ü–µ–Ω—É
    // ...
  },
  '3months': {
    price: 2490, // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é —Ü–µ–Ω—É
    // ...
  },
  yearly: {
    price: 8990, // –ò–∑–º–µ–Ω–∏—Ç–µ –Ω–∞ —Å–≤–æ—é —Ü–µ–Ω—É
    // ...
  }
};
```

–¢–∞–∫–∂–µ –æ–±–Ω–æ–≤–∏—Ç–µ —Ü–µ–Ω—ã –≤ `src/lib/payments.js` –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `createSubscription`:

```javascript
const subscriptionPlans = {
  monthly: { amount: 990, description: '–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 1 –º–µ—Å—è—Ü' },
  '3months': { amount: 2490, description: '–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 3 –º–µ—Å—è—Ü–∞' },
  yearly: { amount: 8990, description: '–ü–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ 1 –≥–æ–¥' }
};
```

## üéâ –í–°–Å –ì–û–¢–û–í–û!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è —ç—Ç–∏—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–¥–ø–∏—Å–∫–∏ –±—É–¥–µ—Ç –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–∞–±–æ—Ç–∞—Ç—å!

## üß™ –ö–∞–∫ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:

1. **–î–æ–±–∞–≤—å—Ç–µ WEBHOOK_SECRET –≤ .env.local** (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–∏–ª–∏)
2. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏:**
   ```bash
   npm run dev
   ```
3. **–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –ø–æ–¥–ø–∏—Å–∫–∏:**
   - –õ–æ–∫–∞–ª—å–Ω–æ: `http://localhost:3000/subscribe`
   - –ò–ª–∏ –Ω–∞ –≤–∞—à–µ–º –¥–æ–º–µ–Ω–µ: `https://pure-progression.com/subscribe`
4. **–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω –∏ –Ω–∞–∂–º–∏—Ç–µ "–û—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É"**
5. **–û–ø–ª–∞—Ç–∏—Ç–µ —Ç–µ—Å—Ç–æ–≤–æ–π –∫–∞—Ä—Ç–æ–π –Æ–∫–∞—Å—Å—ã:**
   - –ù–æ–º–µ—Ä: `5555 5555 5555 4444`
   - –°—Ä–æ–∫: –ª—é–±–∞—è –±—É–¥—É—â–∞—è –¥–∞—Ç–∞
   - CVC: –ª—é–±—ã–µ 3 —Ü–∏—Ñ—Ä—ã
6. **–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã:**
   - –í—ã –±—É–¥–µ—Ç–µ –ø–µ—Ä–µ–Ω–∞–ø—Ä–∞–≤–ª–µ–Ω—ã –Ω–∞ `/payment/success`
   - –ü–æ–¥–ø–∏—Å–∫–∞ –¥–æ–ª–∂–Ω–∞ –ø–æ—è–≤–∏—Ç—å—Å—è –≤ Firebase (–∫–æ–ª–ª–µ–∫—Ü–∏—è `users/{userId}`)
   - –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –∑–∞–π—Ç–∏ –Ω–∞ `/workout-builder` –∏–ª–∏ `/my-workouts` - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –¥–æ—Å—Ç—É–ø

## üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 1: Webhook –ø–æ–ª—É—á–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ
- –õ–æ–≥–∏ WordPress –¥–æ–ª–∂–Ω—ã —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∑–∞–ø–∏—Å–∏ –æ –ø–æ–¥–ø–∏—Å–∫–∞—Ö
- –ò–ª–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫ WordPress

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 2: –ü–æ–¥–ø–∏—Å–∫–∞ –≤ Firebase
1. –û—Ç–∫—Ä–æ–π—Ç–µ Firebase Console
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ Firestore
3. –ù–∞–π–¥–∏—Ç–µ –∫–æ–ª–ª–µ–∫—Ü–∏—é `users`
4. –û—Ç–∫—Ä–æ–π—Ç–µ –¥–æ–∫—É–º–µ–Ω—Ç —Å –≤–∞—à–∏–º `userId`
5. –î–æ–ª–∂–Ω–æ –±—ã—Ç—å –ø–æ–ª–µ `subscription` —Å –¥–∞–Ω–Ω—ã–º–∏:
   ```json
   {
     "subscription": {
       "active": true,
       "type": "monthly",
       "startDate": "...",
       "endDate": "...",
       "paymentId": "...",
       "amount": 990
     }
   }
   ```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ 3: –î–æ—Å—Ç—É–ø –∫ —Å—Ç—Ä–∞–Ω–∏—Ü–∞–º
- –ó–∞–π–¥–∏—Ç–µ –Ω–∞ `/workout-builder` - –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –ó–∞–π–¥–∏—Ç–µ –Ω–∞ `/my-workouts` - –¥–æ–ª–∂–Ω–∞ –æ—Ç–∫—Ä—ã—Ç—å—Å—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- –ï—Å–ª–∏ –ø–æ–¥–ø–∏—Å–∫–∏ –Ω–µ—Ç - –ø–æ–∫–∞–∂–µ—Ç—Å—è –º–æ–¥–∞–ª–∫–∞ —Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ–º –æ—Ñ–æ—Ä–º–∏—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

## ‚ùì –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

### –ü—Ä–æ–±–ª–µ–º–∞: –ü–æ–¥–ø–∏—Å–∫–∞ –Ω–µ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `WEBHOOK_SECRET` –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π –≤ `.env.local` –∏ –≤ `functions.php`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ WordPress (–¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø–∏—Å–∏ –æ–± –æ—à–∏–±–∫–∞—Ö)
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ API endpoint –¥–æ—Å—Ç—É–ø–µ–Ω: `https://pure-progression.com/api/subscription/update`

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç—Ä–∞–Ω–∏—Ü—ã –≤—Å–µ –µ—â–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –ø–æ–¥–ø–∏—Å–∫–∞ –µ—Å—Ç—å –≤ Firebase
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–∞—Ç—É –æ–∫–æ–Ω—á–∞–Ω–∏—è –ø–æ–¥–ø–∏—Å–∫–∏ (–¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º)
3. –û–±–Ω–æ–≤–∏—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É (F5)

### –ü—Ä–æ–±–ª–µ–º–∞: –û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –ø–ª–∞—Ç–µ–∂–∞
**–†–µ—à–µ–Ω–∏–µ:**
1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∫–ª—é—á–∏ –Æ–∫–∞—Å—Å—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –≤ `.env.local`:
   - `NEXT_PUBLIC_YOOKASSA_SHOP_ID`
   - `YOOKASSA_SECRET_KEY`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–µ –∫–ª—é—á–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

## üìù –í–∞–∂–Ω—ã–µ –º–æ–º–µ–Ω—Ç—ã:

1. **–í –Æ–∫–∞—Å—Å–µ –ù–ï –ú–ï–ù–Ø–ô–¢–ï URL webhook** - –æ—Å—Ç–∞–≤—å—Ç–µ –∫–∞–∫ –µ—Å—Ç—å:
   ```
   https://pure-progression.ru/?yookassa=callback
   ```

2. **–°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á** –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º:
   - –í `.env.local` Next.js –ø—Ä–æ–µ–∫—Ç–∞
   - –í `functions.php` WordPress (—Å—Ç—Ä–æ–∫–∞ —Å `$webhookSecret`)

3. **–î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞** —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ:
   - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç–µ –ø—Ä–æ–¥–∞–∫—à–Ω –∫–ª—é—á–∏ –Æ–∫–∞—Å—Å—ã
   - `NEXT_PUBLIC_SITE_URL` —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ–º–µ–Ω
   - Firebase –ø—Ä–∞–≤–∏–ª–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ

## üöÄ –ì–æ—Ç–æ–≤–æ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ —Ä–∞–±–æ—Ç–µ!

