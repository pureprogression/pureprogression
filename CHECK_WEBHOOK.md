# Проверка работы webhook

## Проблема
Подписка не сохранилась после реальной оплаты, хотя тестовая подписка работает.

## Что проверить:

### 1. Проверьте логи WordPress

На сервере Beget проверьте:
- Файл: `/public_html/api/yookassa-webhook.log` (если создавался)
- Или логи ошибок WordPress: `/wp-content/debug.log` (если включен debug)

### 2. Проверьте, что webhook получает данные

В файле `yookassa-subscription-handler.php` добавлена отладка через `error_log`. Проверьте логи PHP.

### 3. Проверьте userId

Важно: userId в платеже должен совпадать с вашим Firebase UID!

Чтобы проверить:
1. Откройте консоль браузера
2. Введите: `firebase.auth().currentUser?.uid`
3. Запомните этот ID

Затем проверьте в логах webhook - какой userId пришел в metadata.

### 4. Проверьте, что код в functions.php правильный

Убедитесь, что код из `yookassa-subscription-handler.php` правильно добавлен в `functions.php` WordPress.

### 5. Проверьте секретный ключ

Убедитесь, что `WEBHOOK_SECRET` одинаковый в:
- `.env.local` Next.js проекта
- `functions.php` WordPress (строка с `$webhookSecret`)

## Временное решение

Пока разбираемся с webhook, можно использовать тестовую кнопку в профиле для создания подписки после оплаты.

## Что делать дальше:

1. Проверьте логи WordPress
2. Проверьте, что webhook URL правильный в Юкассе
3. Проверьте, что код в functions.php работает
4. Если нужно - можно вручную создать подписку через тестовую кнопку после каждой оплаты (временно)

